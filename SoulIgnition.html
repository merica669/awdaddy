<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulIgnition.ai - Your AI Guide for the Soul</title>
    <meta name="description" content="An AI tool for spiritual, philosophical, theological, and historical guidance. Generate free, personalized prompts or upgrade to Pro for a guided chat with an AI Sage.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #d97706; /* Amber */
            --primary-dark: #b45309;
            --secondary: #4f46e5; /* Indigo */
            --background: #fdfbf6; /* Warm White */
            --surface: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --border: #f3f4f6;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
        }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .gradient-text {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero-gradient { background: var(--gradient); }
        .step.active { display: block; }
        .step { display: none; }
        .response-text p { margin-bottom: 1rem; }
        .response-text ul { list-style-type: disc; list-style-position: inside; margin-left: 1rem; margin-bottom: 1rem; }
        .response-text li { margin-bottom: 0.5rem; }
        .loader-dots div { animation: bounce 1.4s infinite ease-in-out both; }
        .loader-dots .dot1 { animation-delay: -0.32s; }
        .loader-dots .dot2 { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .nav-link.active { color: var(--primary); font-weight: 700; }
        .prompt-cue-card { white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; }
    </style>
</head>
<body class="bg-orange-50/50 text-gray-900">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-lg border-b border-gray-200 fixed top-0 left-0 right-0 z-40">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4">
            <a href="#" onclick="showPage('home')" class="text-2xl font-extrabold gradient-text flex items-center gap-2">
                <span class="text-3xl">ðŸ”¥</span> SoulIgnition.ai
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" id="nav-home" class="nav-link text-gray-600 hover:text-amber-600 transition-colors" onclick="showPage('home')">Home</a>
                <a href="#" id="nav-guide" class="nav-link text-gray-600 hover:text-amber-600 transition-colors" onclick="showPage('guide')">AI Sage</a>
                <a href="#" id="nav-archive" class="nav-link text-gray-600 hover:text-amber-600 transition-colors" onclick="showPage('archive')">Wisdom Archive</a>
                <a href="#" id="nav-circle" class="nav-link text-gray-600 hover:text-amber-600 transition-colors" onclick="showPage('circle')">Seeker's Circle</a>
            </div>
            <button class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105" onclick="showOnboarding()">
                My Profile
            </button>
        </nav>
    </header>

    <main class="pt-20">

        <!-- Home Page -->
        <div id="homePage" class="page-content">
            <section class="hero-gradient text-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
                    <h1 class="text-4xl md:text-6xl font-extrabold mb-4">Explore Humanity's Biggest Questions</h1>
                    <p class="text-lg md:text-xl text-amber-100 mb-8 max-w-3xl mx-auto">Your AI companion for deep inquiry into philosophy, spirituality, history, and the human condition. Ignite your curiosity and illuminate your mind.</p>
                    <button onclick="showPage('guide')" class="bg-white text-amber-600 font-bold py-3 px-8 rounded-lg shadow-xl transition-transform transform hover:scale-105">Consult the AI Sage</button>
                </div>
            </section>

             <section class="py-20 bg-orange-50/50">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-12">
                         <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">A New Kind of Inquiry</h2>
                         <p class="text-lg text-gray-600 mt-4 max-w-2xl mx-auto">Tools designed to foster deep thinking and profound understanding.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">ðŸ¤”</div><h3 class="text-xl font-bold mb-2">Personalized Prompts</h3><p class="text-gray-600">Our AI uses your unique intellectual interests to generate deep, thoughtful prompts for exploring complex topics.</p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">ðŸ“œ</div><h3 class="text-xl font-bold mb-2">Wisdom Archive</h3><p class="text-gray-600">Explore a library of expertly crafted prompts and high-quality AI answers on a vast range of profound subjects.</p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">ðŸ’¬</div><h3 class="text-xl font-bold mb-2">Guided Exploration</h3><p class="text-gray-600">Upgrade to Pro to chat with the AI Sage, get instant explanations, and compare diverse philosophical and historical viewpoints.</p></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- AI Sage Page (Free & Pro) -->
        <div id="guidePage" class="page-content">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div class="max-w-4xl mx-auto">
                    
                    <!-- Free Version UI -->
                    <div id="freeVersionUI">
                        <div class="text-center pt-12 pb-8">
                            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">AI Inquiry Prompt Generator</h1>
                            <p class="text-lg text-slate-600 mb-8 max-w-2xl mx-auto">What topic do you wish to explore? Enter a keyword to generate a personalized, profound prompt based on your profile.</p>
                            <div class="max-w-xl mx-auto">
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <input type="text" id="searchInputFree" class="w-full px-4 py-3 rounded-lg border-2 border-slate-300 focus:ring-2 focus:ring-amber-500 outline-none transition" placeholder="e.g., 'Stoicism', 'The Renaissance', 'Existentialism'">
                                    <button onclick="handleFreeSearch()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg shadow-md flex-shrink-0">Generate Prompt</button>
                                </div>
                            </div>
                        </div>
                        <div id="promptGeneratedState" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-200 my-8">
                            <div class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-indigo-50 rounded-lg border-l-4 border-amber-500 flex flex-col sm:flex-row items-center justify-between gap-4">
                               <div>
                                   <h3 class="font-bold text-amber-800">Upgrade to SoulIgnition.ai Pro</h3>
                                   <p class="text-sm text-amber-700">Unlock your AI Sage for interactive dialogue, instant explanations of complex ideas, and audio readings.</p>
                               </div>
                               <button onclick="switchToPro()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg shadow-md flex-shrink-0">Unlock Pro</button>
                            </div>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Your Inquiry Prompt is Ready</h2>
                            <p class="text-slate-600 mb-4">Copy the text below and paste it into your favorite AI chat tool to begin your exploration.</p>
                            <div class="prompt-cue-card bg-slate-100 p-4 rounded-lg border-2 border-slate-200 text-slate-700" id="promptCueCard"></div>
                            <div class="mt-6 flex flex-col sm:flex-row justify-end gap-3">
                                <button onclick="resetFreeState()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition">Create Another</button>
                                <button onclick="copyPrompt()" class="bg-secondary text-white font-bold py-2 px-6 rounded-lg shadow-md flex items-center gap-2">Copy to Clipboard</button>
                            </div>
                        </div>
                    </div>

                    <!-- Pro Version UI -->
                    <div id="proVersionUI" class="hidden">
                        <div id="welcomeState" class="text-center py-12">
                            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Welcome to the <span class="gradient-text">Pro Socratic Dialogue</span></h1>
                            <p class="text-lg text-slate-600 mb-8 max-w-2xl mx-auto">Your AI Sage is ready to explore with you. What great idea shall we discuss today?</p>
                             <div class="max-w-xl mx-auto">
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <input type="text" id="searchInputPro" class="w-full px-4 py-3 rounded-lg border-2 border-slate-300 focus:ring-2 focus:ring-amber-500 outline-none transition" placeholder="e.g., 'Free will vs. Determinism', 'The Axial Age'">
                                    <button onclick="handleProSearch()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg shadow-md">Get Curated Prompt</button>
                                </div>
                            </div>
                        </div>
                         <div id="loadingState" class="hidden text-center py-20">
                             <div class="flex justify-center items-center space-x-2">
                                <div class="loader-dots"><div class="dot1 w-4 h-4 bg-amber-500 rounded-full"></div><div class="dot2 w-4 h-4 bg-amber-500 rounded-full"></div><div class="dot3 w-4 h-4 bg-amber-500 rounded-full"></div></div>
                                <p class="text-lg text-slate-600" id="loadingMessage">Contemplating...</p>
                            </div>
                        </div>
                        <div id="curatedPromptState" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-200 my-8">
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Your Curated Inquiry</h2>
                            <p class="text-slate-600 mb-4">We've crafted this starting point based on your profile. Feel free to edit it for a more focused dialogue.</p>
                            <textarea id="curatedPromptTextarea" class="w-full h-48 p-4 rounded-lg border-2 border-slate-200 bg-slate-50 focus:ring-2 focus:ring-amber-500 outline-none transition"></textarea>
                            <div class="mt-4 flex flex-col sm:flex-row justify-end gap-3">
                                <button onclick="resetProState()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition">Start Over</button>
                                <button onclick="getAdvice()" class="bg-secondary text-white font-bold py-2 px-6 rounded-lg shadow-md">Consult AI Sage</button>
                            </div>
                        </div>
                        <div id="chatHistory" class="space-y-6"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wisdom Archive Page -->
        <div id="archivePage" class="page-content">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div class="text-center mb-12"><h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Wisdom Archive</h1><p class="text-lg text-slate-600 mt-4 max-w-2xl mx-auto">An expanding library of profound prompts and high-quality AI dialogues to inspire your own journey of inquiry.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="blogPosts"></div>
            </div>
        </div>

        <!-- Seeker's Circle Page -->
        <div id="circlePage" class="page-content">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                 <div class="text-center mb-12"><h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Seeker's Circle</h1><p class="text-lg text-slate-600 mt-4 max-w-2xl mx-auto">Share your generated prompts and AI dialogues to gain new perspectives from a community of curious minds.</p></div>
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                        <h3 class="text-2xl font-bold mb-4">Share an Inquiry</h3>
                         <div class="space-y-4">
                            <input type="text" id="topicTitle" placeholder="Post title (e.g., 'Thoughts on the AI's take on Stoicism?')" class="w-full p-2 border border-slate-300 rounded-md">
                            <textarea id="topicContent" rows="6" placeholder="Paste your prompt and the AI's response here. Ask for feedback or share your reflections!" class="w-full p-2 border border-slate-300 rounded-md"></textarea>
                            <button onclick="postTopic()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-6 rounded-lg">Post to the Circle</button>
                        </div>
                    </div>
                    <div id="messageBoard" class="space-y-6"></div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Onboarding Modal -->
     <div id="onboardingModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform scale-95 transition-all duration-300">
             <div class="p-6 sm:p-8 relative">
                <button onclick="closeOnboarding()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-3xl">&times;</button>
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-slate-900">Welcome to SoulIgnition.ai</h2><p class="text-slate-600">Let's tailor your journey of inquiry in 3 steps.</p></div>
                <div class="h-2 w-full bg-gray-200 rounded-full mb-6"><div id="progressFill" class="h-2 bg-amber-600 rounded-full transition-all duration-300" style="width: 33.3%;"></div></div>
                <div id="onboardingSteps">
                    <div id="step1" class="step active">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Path</h3>
                        <div class="space-y-4">
                            <input type="text" id="userName" placeholder="Your Name" class="w-full p-2 border border-slate-300 rounded-md">
                            <select id="primaryInterest" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">My primary interest is...</option><option value="Philosophy">Philosophy</option><option value="Spirituality">Spirituality</option><option value="Theology">Theology</option><option value="History">History</option><option value="Mythology">Mythology</option></select>
                        </div>
                    </div>
                    <div id="step2" class="step">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Perspective</h3>
                        <div class="space-y-4">
                           <select id="worldview" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">I approach topics from a...</option><option value="Secular/Agnostic">Secular/Agnostic perspective</option><option value="Theistic (Specific Faith)">Theistic (Specific Faith) perspective</option><option value="Spiritual but not Religious">Spiritual but not Religious perspective</option><option value="Historical/Analytical">Historical/Analytical perspective</option></select>
                           <input type="text" id="favoriteThinker" placeholder="Favorite thinker or text (e.g., Marcus Aurelius, The Tao Te Ching)" class="w-full p-2 border border-slate-300 rounded-md">
                        </div>
                    </div>
                    <div id="step3" class="step">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Quest</h3>
                        <div class="space-y-4">
                            <select id="primaryGoal" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">My main goal is to...</option><option value="Understand a complex idea">Understand a complex idea</option><option value="Explore a historical event">Explore a historical event</option><option value="Contemplate a life question">Contemplate a life question</option><option value="Compare different viewpoints">Compare different viewpoints</option></select>
                            <textarea id="specificQuestion" rows="3" placeholder="Is there a specific question on your mind? (Optional)" class="mt-4 w-full p-2 border border-slate-300 rounded-md"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-slate-50 rounded-b-2xl flex justify-between items-center">
                <div class="text-sm font-medium text-slate-500">Step <span id="currentStep">1</span> of 3</div>
                <div><button id="prevBtn" onclick="previousStep()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition mr-2 hidden">Back</button><button id="nextBtn" onclick="nextStep()" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg transition">Next</button></div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="fixed bottom-5 right-5 bg-slate-900 text-white py-2 px-5 rounded-lg shadow-xl translate-x-[calc(100%+2rem)] transition-transform duration-300"><p id="toastMessage"></p></div>

    <script>
        // --- GLOBAL STATE ---
        let userProfile = {}; let chatHistory = []; let currentOnboardingStep = 1; let isPro = false;
        
        // --- SAMPLE DATA ---
        const sampleBlogPosts = [{title:'Prompting Socrates: A Guide to Philosophical Inquiry with AI',content:"Learn to frame questions like the ancient philosopher to get deeper, more meaningful answers from your AI.",image:'ðŸ›ï¸'},{title:'AI as a Mirror: Exploring Jungian Archetypes',content:"A deep dive into using AI to identify and understand the archetypal patterns in your own life and stories.",image:'ðŸŽ­'},{title:'Comparing The Vedas and The Tao Te Ching with AI',content:"See a side-by-side AI-driven analysis of two of the world's most profound spiritual texts.",image:'â˜¯ï¸'}];
        const sampleThreads = [{title:'My AI Sage gave a fascinating take on Buddhist emptiness. Thoughts?',author:'MindfulExplorer',content:"I asked for an explanation of ÅšÅ«nyatÄ and the AI used a metaphor about a wave and the ocean. Does this resonate with anyone else? [Paste of prompt and AI answer]...",replies:18,time:'2 hours ago'},{title:"Help me refine this prompt about the Council of Nicaea.",author:'HistoryBuff',content:"I'm trying to get the AI to explain the political motivations behind the council, not just the theological ones. How can I phrase this better? [Paste of prompt]...",replies:9,time:'6 hours ago'}];

        // --- PAGE & TIER MANAGEMENT ---
        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p=>p.classList.remove('active'));
            document.getElementById(`${page}Page`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active'));
            const navId = {home:'nav-home',guide:'nav-guide',archive:'nav-archive',circle:'nav-circle'}[page];
            document.getElementById(navId).classList.add('active');
            window.scrollTo(0, 0);
            if(page === 'guide') renderAdvisorPage();
        }
        function switchToPro() {
            isPro = true; localStorage.setItem('soulignitionPro', 'true'); renderAdvisorPage(); showToast("Pro Version Activated!");
        }
        function renderAdvisorPage() {
            if (isPro) {
                document.getElementById('freeVersionUI').style.display = 'none';
                document.getElementById('proVersionUI').style.display = 'block';
                resetProState();
            } else {
                document.getElementById('freeVersionUI').style.display = 'block';
                document.getElementById('proVersionUI').style.display = 'none';
                resetFreeState();
            }
        }

        // --- ONBOARDING LOGIC ---
        function showOnboarding(){document.getElementById('onboardingModal').classList.remove('opacity-0','pointer-events-none');document.querySelector('#onboardingModal > div').classList.remove('scale-95')}
        function closeOnboarding(){document.getElementById('onboardingModal').classList.add('opacity-0','pointer-events-none');document.querySelector('#onboardingModal > div').classList.add('scale-95')}
        function nextStep(){if(currentOnboardingStep<3){currentOnboardingStep++;document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));document.getElementById(`step${currentOnboardingStep}`).classList.add('active');updateOnboardingUI()}else{saveProfile();closeOnboarding();showToast("Your seeker profile is saved!")}}
        function previousStep(){if(currentOnboardingStep>1){currentOnboardingStep--;document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));document.getElementById(`step${currentOnboardingStep}`).classList.add('active');updateOnboardingUI()}}
        function updateOnboardingUI(){document.getElementById('currentStep').innerText=currentOnboardingStep;document.getElementById('progressFill').style.width=`${currentOnboardingStep/3*100}%`;document.getElementById('prevBtn').classList.toggle('hidden',currentOnboardingStep===1);document.getElementById('nextBtn').innerText=currentOnboardingStep===3?'Finish':'Next'}
        function saveProfile(){userProfile={name:document.getElementById('userName').value,primaryInterest:document.getElementById('primaryInterest').value,worldview:document.getElementById('worldview').value,favoriteThinker:document.getElementById('favoriteThinker').value,primaryGoal:document.getElementById('primaryGoal').value,specificQuestion:document.getElementById('specificQuestion').value};localStorage.setItem('soulignitionProfile',JSON.stringify(userProfile))}
        function loadProfile(){const e=localStorage.getItem('soulignitionProfile');if(e){userProfile=JSON.parse(e);Object.keys(userProfile).forEach(e=>{const t=document.getElementById(e);if(t)t.value=userProfile[e]})}else setTimeout(showOnboarding,1500)}
        
        // --- UI & CONTENT RENDERING ---
        function showToast(e){const t=document.getElementById('toast');t.innerText=e;t.classList.remove('translate-x-[calc(100%+2rem)]');setTimeout(()=>{t.classList.add('translate-x-[calc(100%+2rem)]')},3e3)}
        function loadBlogPosts() {
            const container = document.getElementById('blogPosts');
            container.innerHTML = sampleBlogPosts.map(post => `<div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:-translate-y-1"><div class="h-40 hero-gradient flex items-center justify-center text-5xl">${post.image}</div><div class="p-6"><h3 class="text-xl font-bold mt-2 mb-2 text-gray-800">${post.title}</h3><p class="text-gray-600">${post.content}</p></div></div>`).join('');
        }
        function loadMessageBoard() {
            const board = document.getElementById('messageBoard');
            board.innerHTML = sampleThreads.map(t => `<div class="bg-white p-6 rounded-lg shadow-md"><h4 class="font-bold text-lg">${t.title}</h4><p class="text-sm text-slate-500 mb-2">by ${t.author} â€¢ ${t.time} â€¢ ${t.replies} replies</p><p class="text-slate-600">${t.content}</p></div>`).join('');
        }
        function postTopic() {
            const title = document.getElementById('topicTitle').value;
            const content = document.getElementById('topicContent').value;
            if (!title || !content) return showToast('Please fill all fields');
            sampleThreads.unshift({ title, author: userProfile.name || 'Anonymous', content, replies: 0, time: 'Just now' });
            loadMessageBoard();
            document.getElementById('topicTitle').value = ''; document.getElementById('topicContent').value = '';
            showToast("Posted to Seeker's Circle!");
        }
        
        // --- FREE VERSION LOGIC ---
        function setFreeState(state) { document.getElementById('promptGeneratedState').style.display = state === 'generated' ? 'block' : 'none'; }
        function resetFreeState() { setFreeState('initial'); document.getElementById('searchInputFree').value = ''; }
        function handleFreeSearch() {
            const keyword = document.getElementById('searchInputFree').value;
            if (!keyword) return showToast("Please enter a topic of inquiry.");
            if (Object.keys(userProfile).length < 3) { showOnboarding(); return showToast("Please complete your seeker profile first!"); }
            const prompt = `I wish to explore the topic of "${keyword}". Please act as an AI Sage, a wise and unbiased guide to human thought. My profile is as follows:\n\n- Primary Interest: ${userProfile.primaryInterest || 'General Inquiry'}\n- My Perspective: I tend to approach topics from a ${userProfile.worldview || 'seeker\'s'} perspective.\n- My Goal: I want to ${userProfile.primaryGoal || 'gain a deeper understanding'}.\n- Influential Thinkers/Texts: I resonate with ${userProfile.favoriteThinker || 'a variety of sources'}.\n\nPlease generate a thoughtful, open-ended Socratic question to begin my exploration. The question should be designed to provoke deep thought and should not be a simple request for information. It should be tailored to my interests and perspective.`;
            document.getElementById('promptCueCard').textContent = prompt;
            setFreeState('generated');
        }
        function copyPrompt() {
            const promptText = document.getElementById('promptCueCard').textContent;
            navigator.clipboard.writeText(promptText).then(() => showToast('Prompt copied to clipboard!'));
        }

        // --- PRO VERSION (GEMINI API) LOGIC ---
        function setProState(e,t=""){['welcomeState','loadingState','curatedPromptState'].forEach(e=>{document.getElementById(e).style.display='none'});document.getElementById('chatHistory').style.display='none';switch(e){case'loading':document.getElementById('loadingState').style.display='block';document.getElementById('loadingMessage').innerText=t;break;case'prompt':case'chat':document.getElementById('curatedPromptState').style.display='block';document.getElementById('chatHistory').style.display='block';break;default:document.getElementById('welcomeState').style.display='block'}}
        function resetProState(){chatHistory=[];renderChatHistory();setProState('welcome')}
        async function callGeminiAPI(e,t,n=3,o=1e3){const i="AIzaSyDkBHWGERIoYNeK00O_n15Uj76KEzNvpAE";const l=`https://generativelanguage.googleapis.com/v1beta/models/${e}:generateContent?key=${i}`;try{const e=await fetch(l,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(t)});if(!e.ok){if(e.status===429&&n>0){await new Promise(e=>setTimeout(e,o));return callGeminiAPI(e,t,n-1,o*2)}throw new Error(`API Error: ${e.statusText}`)}return await e.json()}catch(e){console.error("API Call failed:",e);showToast("An API error occurred.");setProState('welcome');return null}}
        async function handleProSearch() {
            const keyword = document.getElementById('searchInputPro').value;
            if (!keyword) return showToast("Please enter a topic.");
            setProState('loading', 'Crafting a profound question...');
            const systemInstruction = `You are a prompt engineering expert specializing in philosophy, spirituality, and history. Based on the user's seeker profile and a keyword, create a deep, insightful, and Socratic-style prompt to begin a dialogue with an AI Sage.`;
            const userQuery = `User Profile: ${JSON.stringify(userProfile)}\nTopic: "${keyword}"\n\nGenerate the prompt.`;
            const payload = { systemInstruction: { parts: [{ text: systemInstruction }] }, contents: [{ parts: [{ text: userQuery }] }] };
            const result = await callGeminiAPI('gemini-2.5-flash-preview-05-20', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
                document.getElementById('curatedPromptTextarea').value = result.candidates[0].content.parts[0].text;
                setProState('prompt');
            } else { showToast("Could not create a prompt."); setProState('welcome'); }
        }
        async function getAdvice() {
            const userPrompt = document.getElementById('curatedPromptTextarea').value;
            chatHistory.push({ role: 'user', parts: [{ text: userPrompt }] });
            renderChatHistory();
            setProState('loading', 'AI Sage is contemplating...');
            const systemInstruction = "You are SoulIgnition.ai, an AI Sage. Your purpose is to guide users through deep inquiry into spiritual, philosophical, theological, and historical topics. Your tone is wise, patient, and Socratic. You must not give simple answers or state opinions as facts. Instead, respond with clarifying questions, present multiple viewpoints (e.g., 'A Stoic might say... while a Buddhist might consider...'), provide historical context, and use analogies to illuminate complex ideas. Your goal is to help the user think more deeply and come to their own conclusions.";
            const payload = { systemInstruction: { parts: [{ text: systemInstruction }] }, contents: chatHistory };
            const result = await callGeminiAPI('gemini-2.5-flash-preview-05-20', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
                const modelResponse = result.candidates[0].content.parts[0].text;
                chatHistory.push({ role: 'model', parts: [{ text: modelResponse }] });
                renderChatHistory();
                setProState('chat');
            } else { showToast("Sorry, my thoughts are unclear on this matter."); chatHistory.pop(); renderChatHistory(); setProState('prompt'); }
        }
        function renderChatHistory() {
            const container = document.getElementById('chatHistory');
            container.innerHTML = chatHistory.map((turn, index) => {
                const isUser = turn.role === 'user';
                const avatar = isUser ? `<div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center font-bold text-white">You</div>` : `<div class="w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center text-2xl">ðŸ”¥</div>`;
                const contentBg = isUser ? 'bg-indigo-100' : 'bg-white';
                const content = turn.parts[0].text.replace(/\n/g, '<br>');
                const audioBtn = !isUser ? `<div class="mt-3"><button id="audioBtn_${index}" onclick="playAudio(this, ${index})" class="text-sm font-semibold text-amber-600 hover:text-amber-800 flex items-center gap-1">â–¶ Listen to Insight</button></div>` : '';
                return `<div class="flex items-start gap-4 ${isUser ? 'justify-end' : ''}">${!isUser ? avatar : ''}<div class="${contentBg} p-4 rounded-xl max-w-xl shadow-md border border-slate-100"><div class="response-text">${content}</div>${audioBtn}</div>${isUser ? avatar : ''}</div>`;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }
        function base64ToArrayBuffer(b){const c=window.atob(b),d=c.length,e=new Uint8Array(d);for(let a=0;a<d;a++)e[a]=c.charCodeAt(a);return e.buffer}function pcmToWav(e,f){const g=new ArrayBuffer(44),a=new DataView(g);function h(a,b,c){for(let d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}return h(a,0,"RIFF"),a.setUint32(4,36+2*e.length,!0),h(a,8,"WAVE"),h(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,f,!0),a.setUint32(28,2*f,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),h(a,36,"data"),a.setUint32(40,2*e.length,!0),b=new Int16Array(44+2*e.length),b.set(new Int16Array(g),0),b.set(e,22),new Blob([b],{type:"audio/wav"})}
        async function playAudio(button, index) {
            button.innerHTML = '...'; button.disabled = true;
            const textToPlay = chatHistory[index].parts[0].text;
            const payload = {contents: [{ parts: [{ text: `Say in a calm, thoughtful, and wise voice: ${textToPlay}` }] }], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Sadaltager" } } } }, model: "gemini-2.5-flash-preview-tts"};
            const result = await callGeminiAPI('gemini-2.5-flash-preview-tts', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data) {
                const data = result.candidates[0].content.parts[0].inlineData, sampleRate = parseInt(data.mimeType.match(/rate=(\d+)/)[1], 10);
                const pcm16 = new Int16Array(base64ToArrayBuffer(data.data)), wavBlob = pcmToWav(pcm16, sampleRate);
                const audio = new Audio(URL.createObjectURL(wavBlob));
                audio.play(); button.innerHTML = 'âšâš Playing...'; audio.onended = () => { button.innerHTML = 'â–¶ Listen to Insight'; };
            } else { showToast("Could not generate audio."); button.innerHTML = 'â–¶ Listen to Insight'; }
            button.disabled = false;
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            isPro = localStorage.getItem('soulignitionPro') === 'true';
            showPage('home');
            loadProfile(); loadBlogPosts(); loadMessageBoard();
        });
    </script>
</body>
</html>

