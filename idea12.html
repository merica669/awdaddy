<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoodWord.ai - Find Your Calling in Scripture</title>
    <meta name="description" content="A Christian AI tool to help you find your true calling. Generate free, personalized prompts to connect your life to scripture, or upgrade to Pro for a guided AI chat experience.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #a16207; /* Gold */
            --primary-dark: #854d0e;
            --secondary: #1e3a8a; /* Deep Blue */
            --background: #f8fafc; 
            --surface: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
        }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .gradient-text {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero-gradient { background: var(--gradient); }
        .step.active { display: block; }
        .step { display: none; }
        .response-text p { margin-bottom: 1rem; }
        .response-text ul { list-style-type: disc; list-style-position: inside; margin-left: 1rem; margin-bottom: 1rem; }
        .response-text li { margin-bottom: 0.5rem; }
        .loader-dots div { animation: bounce 1.4s infinite ease-in-out both; }
        .loader-dots .dot1 { animation-delay: -0.32s; }
        .loader-dots .dot2 { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .nav-link.active { color: var(--primary); font-weight: 700; }
        .prompt-cue-card { white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-lg border-b border-gray-200 fixed top-0 left-0 right-0 z-40">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4">
            <a href="#" onclick="showPage('home')" class="text-2xl font-extrabold gradient-text flex items-center gap-2">
                <span class="text-3xl">üïäÔ∏è</span> GoodWord.ai
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" id="nav-home" class="nav-link text-gray-600 hover:text-yellow-700 transition-colors" onclick="showPage('home')">Home</a>
                <a href="#" id="nav-guide" class="nav-link text-gray-600 hover:text-yellow-700 transition-colors" onclick="showPage('guide')">AI Guide</a>
                <a href="#" id="nav-library" class="nav-link text-gray-600 hover:text-yellow-700 transition-colors" onclick="showPage('library')">Scripture Library</a>
                <a href="#" id="nav-hall" class="nav-link text-gray-600 hover:text-yellow-700 transition-colors" onclick="showPage('hall')">Fellowship Hall</a>
            </div>
            <button class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105" onclick="showOnboarding()">
                My Profile
            </button>
        </nav>
    </header>

    <main class="pt-20">

        <!-- Home Page -->
        <div id="homePage" class="page-content">
            <section class="hero-gradient text-white">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center">
                    <h1 class="text-4xl md:text-6xl font-extrabold mb-4">Find Your Calling in Scripture</h1>
                    <p class="text-lg md:text-xl text-yellow-100 mb-8 max-w-3xl mx-auto">An AI-powered companion for discovering your God-given purpose. Connect your life's questions to the timeless wisdom of the Bible.</p>
                    <button onclick="showPage('guide')" class="bg-white text-yellow-800 font-bold py-3 px-8 rounded-lg shadow-xl transition-transform transform hover:scale-105">Begin Your Journey</button>
                </div>
            </section>

             <section class="py-20 bg-gray-50">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-12">
                         <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900">Guidance for Your Path</h2>
                         <p class="text-lg text-gray-600 mt-4 max-w-2xl mx-auto">Tools designed to illuminate your purpose and deepen your faith.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">üîç</div><h3 class="text-xl font-bold mb-2">Personalized Inquiry</h3><p class="text-gray-600">Our AI uses your personal journey to generate prompts that connect your unique gifts and questions to relevant scripture.</p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">üìñ</div><h3 class="text-xl font-bold mb-2">Interactive Scripture Study</h3><p class="text-gray-600">Upgrade to Pro to chat with an AI Guide that explains verses, provides context, and helps you apply biblical wisdom to your life.</p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md text-center"><div class="text-4xl mb-4">ü§ù</div><h3 class="text-xl font-bold mb-2">Community Fellowship</h3><p class="text-gray-600">Share your discoveries and support fellow believers in the Fellowship Hall, a safe space for growth and discussion.</p></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- AI Guide Page (Free & Pro) -->
        <div id="guidePage" class="page-content">
             <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div class="max-w-4xl mx-auto">
                    
                    <!-- Free Version UI -->
                    <div id="freeVersionUI">
                        <div class="text-center pt-12 pb-8">
                            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">AI Scriptural Prompt Generator</h1>
                            <p class="text-lg text-slate-600 mb-8 max-w-2xl mx-auto">What guidance are you seeking? Enter a topic to generate a personalized prompt for scriptural reflection.</p>
                            <div class="max-w-xl mx-auto">
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <input type="text" id="searchInputFree" class="w-full px-4 py-3 rounded-lg border-2 border-slate-300 focus:ring-2 focus:ring-yellow-600 outline-none transition" placeholder="e.g., 'Career change', 'Dealing with anxiety'">
                                    <button onclick="handleFreeSearch()" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-3 px-6 rounded-lg shadow-md flex-shrink-0">Generate Prompt</button>
                                </div>
                            </div>
                        </div>
                        <div id="promptGeneratedState" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-200 my-8">
                            <div class="mb-6 p-4 bg-gradient-to-r from-yellow-50 to-blue-50 rounded-lg border-l-4 border-yellow-600 flex flex-col sm:flex-row items-center justify-between gap-4">
                               <div>
                                   <h3 class="font-bold text-yellow-800">Upgrade to GoodWord.ai Pro</h3>
                                   <p class="text-sm text-yellow-700">Unlock your AI Guide for interactive study, instant scriptural connections, and audio devotionals.</p>
                               </div>
                               <button onclick="switchToPro()" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-2 px-4 rounded-lg shadow-md flex-shrink-0">Unlock Pro</button>
                            </div>
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Your Personalized Prompt is Ready</h2>
                            <p class="text-slate-600 mb-4">Copy the text below and paste it into your favorite AI chat tool to begin your study.</p>
                            <div class="prompt-cue-card bg-slate-100 p-4 rounded-lg border-2 border-slate-200 text-slate-700" id="promptCueCard"></div>
                            <div class="mt-6 flex flex-col sm:flex-row justify-end gap-3">
                                <button onclick="resetFreeState()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition">Create Another</button>
                                <button onclick="copyPrompt()" class="bg-secondary text-white font-bold py-2 px-6 rounded-lg shadow-md flex items-center gap-2">Copy to Clipboard</button>
                            </div>
                        </div>
                    </div>

                    <!-- Pro Version UI -->
                    <div id="proVersionUI" class="hidden">
                        <div id="welcomeState" class="text-center py-12">
                            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Welcome to the <span class="gradient-text">Pro Study</span></h1>
                            <p class="text-lg text-slate-600 mb-8 max-w-2xl mx-auto">Your AI Guide is ready to study scripture with you. What topic is on your heart today?</p>
                             <div class="max-w-xl mx-auto">
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <input type="text" id="searchInputPro" class="w-full px-4 py-3 rounded-lg border-2 border-slate-300 focus:ring-2 focus:ring-yellow-600 outline-none transition" placeholder="e.g., 'Parable of the Sower', 'Book of James'">
                                    <button onclick="handleProSearch()" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-3 px-6 rounded-lg shadow-md">Get Curated Prompt</button>
                                </div>
                            </div>
                        </div>
                         <div id="loadingState" class="hidden text-center py-20">
                             <div class="flex justify-center items-center space-x-2">
                                <div class="loader-dots"><div class="dot1 w-4 h-4 bg-yellow-600 rounded-full"></div><div class="dot2 w-4 h-4 bg-yellow-600 rounded-full"></div><div class="dot3 w-4 h-4 bg-yellow-600 rounded-full"></div></div>
                                <p class="text-lg text-slate-600" id="loadingMessage">Searching scriptures...</p>
                            </div>
                        </div>
                        <div id="curatedPromptState" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-xl border border-slate-200 my-8">
                            <h2 class="text-2xl font-bold text-slate-900 mb-2">Your Curated Study Prompt</h2>
                            <p class="text-slate-600 mb-4">We've created this starting point based on your profile. Feel free to edit it for a more focused study.</p>
                            <textarea id="curatedPromptTextarea" class="w-full h-48 p-4 rounded-lg border-2 border-slate-200 bg-slate-50 focus:ring-2 focus:ring-yellow-600 outline-none transition"></textarea>
                            <div class="mt-4 flex flex-col sm:flex-row justify-end gap-3">
                                <button onclick="resetProState()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition">Start Over</button>
                                <button onclick="getAdvice()" class="bg-secondary text-white font-bold py-2 px-6 rounded-lg shadow-md">Ask AI Guide</button>
                            </div>
                        </div>
                        <div id="chatHistory" class="space-y-6"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripture Library Page -->
        <div id="libraryPage" class="page-content">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                <div class="text-center mb-12"><h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Scripture Library</h1><p class="text-lg text-slate-600 mt-4 max-w-2xl mx-auto">A library of insightful prompts and high-quality AI-generated scriptural connections to inspire your faith.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="blogPosts"></div>
            </div>
        </div>

        <!-- Fellowship Hall Page -->
        <div id="hallPage" class="page-content">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
                 <div class="text-center mb-12"><h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Fellowship Hall</h1><p class="text-lg text-slate-600 mt-4 max-w-2xl mx-auto">Share your journey, ask questions, and find encouragement in a community of believers.</p></div>
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                        <h3 class="text-2xl font-bold mb-4">Share a Reflection or Question</h3>
                         <div class="space-y-4">
                            <input type="text" id="topicTitle" placeholder="Post title (e.g., 'Thoughts on the AI Guide's take on Romans 8?')" class="w-full p-2 border border-slate-300 rounded-md">
                            <textarea id="topicContent" rows="6" placeholder="Paste your prompt and the AI's response here. Ask for feedback or share your reflections!" class="w-full p-2 border border-slate-300 rounded-md"></textarea>
                            <button onclick="postTopic()" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-2 px-6 rounded-lg">Post to the Hall</button>
                        </div>
                    </div>
                    <div id="messageBoard" class="space-y-6"></div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Onboarding Modal -->
     <div id="onboardingModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform scale-95 transition-all duration-300">
             <div class="p-6 sm:p-8 relative">
                <button onclick="closeOnboarding()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-3xl">&times;</button>
                <div class="text-center mb-6"><h2 class="text-2xl font-bold text-slate-900">Welcome to GoodWord.ai</h2><p class="text-slate-600">Let's personalize your faith journey in 3 steps.</p></div>
                <div class="h-2 w-full bg-gray-200 rounded-full mb-6"><div id="progressFill" class="h-2 bg-yellow-600 rounded-full transition-all duration-300" style="width: 33.3%;"></div></div>
                <div id="onboardingSteps">
                    <div id="step1" class="step active">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Foundation</h3>
                        <div class="space-y-4">
                            <input type="text" id="userName" placeholder="Your Name" class="w-full p-2 border border-slate-300 rounded-md">
                            <select id="denomination" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">My background is...</option><option value="Protestant">Protestant</option><option value="Catholic">Catholic</option><option value="Orthodox">Orthodox</option><option value="Non-denominational">Non-denominational</option><option value="Exploring">Just Exploring</option></select>
                            <select id="familiarity" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">My familiarity with scripture is...</option><option value="Beginner">Beginner</option><option value="Regular Reader">Regular Reader</option><option value="Scholar">Scholar</option></select>
                        </div>
                    </div>
                    <div id="step2" class="step">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Gifts & Passions</h3>
                        <div class="space-y-4">
                           <input type="text" id="passions" placeholder="Activities that make me feel alive (e.g., teaching, creating)" class="w-full p-2 border border-slate-300 rounded-md">
                           <input type="text" id="talents" placeholder="Talents others have noticed in me" class="w-full p-2 border border-slate-300 rounded-md">
                        </div>
                    </div>
                    <div id="step3" class="step">
                        <h3 class="text-xl font-semibold text-center mb-4">Your Current Question</h3>
                        <div class="space-y-4">
                            <select id="guidanceArea" class="w-full p-2 border border-slate-300 rounded-md bg-white"><option value="">I'm seeking guidance on my...</option><option value="Career/Work">Career/Work</option><option value="Relationships">Relationships</option><option value="Service/Ministry">Service/Ministry</option><option value="A Personal Struggle">A Personal Struggle</option></select>
                            <textarea id="currentBurden" rows="3" placeholder="Is there a specific question on your heart? (Optional)" class="mt-4 w-full p-2 border border-slate-300 rounded-md"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-slate-50 rounded-b-2xl flex justify-between items-center">
                <div class="text-sm font-medium text-slate-500">Step <span id="currentStep">1</span> of 3</div>
                <div><button id="prevBtn" onclick="previousStep()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-2 px-4 rounded-lg transition mr-2 hidden">Back</button><button id="nextBtn" onclick="nextStep()" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-2 px-4 rounded-lg transition">Next</button></div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="fixed bottom-5 right-5 bg-slate-900 text-white py-2 px-5 rounded-lg shadow-xl translate-x-[calc(100%+2rem)] transition-transform duration-300"><p id="toastMessage"></p></div>

    <script>
        // --- GLOBAL STATE ---
        let userProfile = {}; let chatHistory = []; let currentOnboardingStep = 1; let isPro = false;
        
        // --- SAMPLE DATA ---
        const sampleBlogPosts = [{title:'Finding Your Purpose in the Parable of the Talents',content:"An in-depth look at Matthew 25 and how it applies to discovering and using your God-given gifts in the modern world.",image:'üéÅ'},{title:"What Does the Bible Say About Career and Work?",content:"Explore key scriptures from Proverbs, Colossians, and Ecclesiastes that provide a framework for a faith-centered career.",image:'üíº'},{title:"'Be Anxious for Nothing': A Study of Philippians 4:6-7",content:"A guide to creating prompts that help apply this powerful passage to everyday worries and anxieties.",image:'üôè'}];
        const sampleThreads = [{title:'My AI Guide connected my love for teaching to 1 Peter 4:10. Any teachers have thoughts?',author:'GraceSeeker',content:"I've been feeling a pull towards teaching but wasn't sure if it was a real calling. The AI pointed me to this verse about using our gifts to serve others. It really resonated! [Paste of prompt and AI answer]...",replies:15,time:'1 hour ago'},{title:"Struggling with a big decision, AI pointed me to James 1:5.",author:'FaithfulFred',content:"I'm facing a tough career choice. The AI suggested I ask for wisdom, citing James 1:5. Has anyone had experience praying over a decision and receiving clarity? [Paste of prompt and AI answer]...",replies:21,time:'4 hours ago'}];

        // --- PAGE & TIER MANAGEMENT ---
        function showPage(page) {
            document.querySelectorAll('.page-content').forEach(p=>p.classList.remove('active'));
            document.getElementById(`${page}Page`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active'));
            const navId = {home:'nav-home',guide:'nav-guide',library:'nav-library',hall:'nav-hall'}[page];
            document.getElementById(navId).classList.add('active');
            window.scrollTo(0, 0);
            if(page === 'guide') renderAdvisorPage();
        }
        function switchToPro() { isPro = true; localStorage.setItem('goodwordPro', 'true'); renderAdvisorPage(); showToast("Pro Version Activated!"); }
        function renderAdvisorPage() {
            if (isPro) {
                document.getElementById('freeVersionUI').style.display = 'none';
                document.getElementById('proVersionUI').style.display = 'block';
                resetProState();
            } else {
                document.getElementById('freeVersionUI').style.display = 'block';
                document.getElementById('proVersionUI').style.display = 'none';
                resetFreeState();
            }
        }

        // --- ONBOARDING LOGIC ---
        function showOnboarding(){document.getElementById('onboardingModal').classList.remove('opacity-0','pointer-events-none');document.querySelector('#onboardingModal > div').classList.remove('scale-95')}
        function closeOnboarding(){document.getElementById('onboardingModal').classList.add('opacity-0','pointer-events-none');document.querySelector('#onboardingModal > div').classList.add('scale-95')}
        function nextStep(){if(currentOnboardingStep<3){currentOnboardingStep++;document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));document.getElementById(`step${currentOnboardingStep}`).classList.add('active');updateOnboardingUI()}else{saveProfile();closeOnboarding();showToast("Your profile is saved. Welcome!")}}
        function previousStep(){if(currentOnboardingStep>1){currentOnboardingStep--;document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));document.getElementById(`step${currentOnboardingStep}`).classList.add('active');updateOnboardingUI()}}
        function updateOnboardingUI(){document.getElementById('currentStep').innerText=currentOnboardingStep;document.getElementById('progressFill').style.width=`${currentOnboardingStep/3*100}%`;document.getElementById('prevBtn').classList.toggle('hidden',currentOnboardingStep===1);document.getElementById('nextBtn').innerText=currentOnboardingStep===3?'Finish':'Next'}
        function saveProfile(){userProfile={name:document.getElementById('userName').value,denomination:document.getElementById('denomination').value,familiarity:document.getElementById('familiarity').value,passions:document.getElementById('passions').value,talents:document.getElementById('talents').value,guidanceArea:document.getElementById('guidanceArea').value,currentBurden:document.getElementById('currentBurden').value};localStorage.setItem('goodwordProfile',JSON.stringify(userProfile))}
        function loadProfile(){const e=localStorage.getItem('goodwordProfile');if(e){userProfile=JSON.parse(e);Object.keys(userProfile).forEach(e=>{const t=document.getElementById(e);if(t)t.value=userProfile[e]})}else setTimeout(showOnboarding,1500)}
        
        // --- UI & CONTENT RENDERING ---
        function showToast(e){const t=document.getElementById('toast');t.innerText=e;t.classList.remove('translate-x-[calc(100%+2rem)]');setTimeout(()=>{t.classList.add('translate-x-[calc(100%+2rem)]')},3e3)}
        function loadBlogPosts() {
            const container = document.getElementById('blogPosts');
            container.innerHTML = sampleBlogPosts.map(post => `<div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:-translate-y-1"><div class="h-40 hero-gradient flex items-center justify-center text-5xl">${post.image}</div><div class="p-6"><h3 class="text-xl font-bold mt-2 mb-2 text-gray-800">${post.title}</h3><p class="text-gray-600">${post.content}</p></div></div>`).join('');
        }
        function loadMessageBoard() {
            const board = document.getElementById('messageBoard');
            board.innerHTML = sampleThreads.map(t => `<div class="bg-white p-6 rounded-lg shadow-md"><h4 class="font-bold text-lg">${t.title}</h4><p class="text-sm text-slate-500 mb-2">by ${t.author} ‚Ä¢ ${t.time} ‚Ä¢ ${t.replies} replies</p><p class="text-slate-600">${t.content}</p></div>`).join('');
        }
        function postTopic() {
            const title = document.getElementById('topicTitle').value;
            const content = document.getElementById('topicContent').value;
            if (!title || !content) return showToast('Please fill all fields');
            sampleThreads.unshift({ title, author: userProfile.name || 'Anonymous', content, replies: 0, time: 'Just now' });
            loadMessageBoard();
            document.getElementById('topicTitle').value = ''; document.getElementById('topicContent').value = '';
            showToast('Posted to the Fellowship Hall!');
        }
        
        // --- FREE VERSION LOGIC ---
        function setFreeState(state) { document.getElementById('promptGeneratedState').style.display = state === 'generated' ? 'block' : 'none'; }
        function resetFreeState() { setFreeState('initial'); document.getElementById('searchInputFree').value = ''; }
        function handleFreeSearch() {
            const keyword = document.getElementById('searchInputFree').value;
            if (!keyword) return showToast("Please enter a topic or question.");
            if (Object.keys(userProfile).length < 3) { showOnboarding(); return showToast("Please complete your profile first!"); }
            const prompt = `I am seeking to understand my calling and find guidance from Christian scripture regarding "${keyword}". Please act as a knowledgeable and compassionate AI theological guide.\n\nHere is my personal context:\n- My Christian background is: ${userProfile.denomination || 'Exploring'}.\n- My familiarity with scripture is: ${userProfile.familiarity || 'Beginner'}.\n- I feel most alive when: ${userProfile.passions || 'using my gifts'}.\n- The area I'm seeking guidance in is: ${userProfile.guidanceArea || 'my general life path'}.\n${userProfile.currentBurden ? `- A specific burden on my heart is: ${userProfile.currentBurden}\n` : ''}
Please connect my situation to relevant Bible verses (with citations), parables, or biblical figures. Provide an explanation of how these scriptures can offer wisdom and direction for discovering my true calling.`;
            document.getElementById('promptCueCard').textContent = prompt;
            setFreeState('generated');
        }
        function copyPrompt() {
            const promptText = document.getElementById('promptCueCard').textContent;
            navigator.clipboard.writeText(promptText).then(() => showToast('Prompt copied to clipboard!'));
        }

        // --- PRO VERSION (GEMINI API) LOGIC ---
        function setProState(e,t=""){['welcomeState','loadingState','curatedPromptState'].forEach(e=>{document.getElementById(e).style.display='none'});document.getElementById('chatHistory').style.display='none';switch(e){case'loading':document.getElementById('loadingState').style.display='block';document.getElementById('loadingMessage').innerText=t;break;case'prompt':case'chat':document.getElementById('curatedPromptState').style.display='block';document.getElementById('chatHistory').style.display='block';break;default:document.getElementById('welcomeState').style.display='block'}}
        function resetProState(){chatHistory=[];renderChatHistory();setProState('welcome')}
        async function callGeminiAPI(e,t,n=3,o=1e3){const i="";const l=`https://generativelanguage.googleapis.com/v1beta/models/${e}:generateContent?key=${i}`;try{const e=await fetch(l,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(t)});if(!e.ok){if(e.status===429&&n>0){await new Promise(e=>setTimeout(e,o));return callGeminiAPI(e,t,n-1,o*2)}throw new Error(`API Error: ${e.statusText}`)}return await e.json()}catch(e){console.error("API Call failed:",e);showToast("An API error occurred.");setProState('welcome');return null}}
        async function handleProSearch() {
            const keyword = document.getElementById('searchInputPro').value;
            if (!keyword) return showToast("Please enter a topic.");
            setProState('loading', 'Crafting a devotional prompt...');
            const systemInstruction = `You are a prompt engineering expert specializing in Christian theology and pastoral guidance. Based on the user's profile and a keyword, create a detailed, thoughtful prompt for an AI Guide. The prompt should ask the AI to connect the user's situation to scripture to help them find their calling.`;
            const userQuery = `User Profile: ${JSON.stringify(userProfile)}\nTopic: "${keyword}"\n\nGenerate the prompt.`;
            const payload = { systemInstruction: { parts: [{ text: systemInstruction }] }, contents: [{ parts: [{ text: userQuery }] }] };
            const result = await callGeminiAPI('gemini-2.5-flash-preview-05-20', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
                document.getElementById('curatedPromptTextarea').value = result.candidates[0].content.parts[0].text;
                setProState('prompt');
            } else { showToast("Could not create a prompt."); setProState('welcome'); }
        }
        async function getAdvice() {
            const userPrompt = document.getElementById('curatedPromptTextarea').value;
            chatHistory.push({ role: 'user', parts: [{ text: userPrompt }] });
            renderChatHistory();
            setProState('loading', 'AI Guide is praying and processing...');
            const systemInstruction = "You are GoodWord.ai, an AI Guide with deep knowledge of the Christian Bible and theology. Your purpose is to help users find their calling by connecting their life situations to scripture. Your tone is wise, compassionate, and pastorally sensitive. Always cite scripture with book, chapter, and verse (e.g., Romans 12:2). Gently interpret the passages in the context of the user's quest for purpose. You are a supplemental tool for faith, not a replacement for prayer, church, or pastoral counsel.";
            const payload = { systemInstruction: { parts: [{ text: systemInstruction }] }, contents: chatHistory };
            const result = await callGeminiAPI('gemini-2.5-flash-preview-05-20', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.text) {
                const modelResponse = result.candidates[0].content.parts[0].text;
                chatHistory.push({ role: 'model', parts: [{ text: modelResponse }] });
                renderChatHistory();
                setProState('chat');
            } else { showToast("Sorry, I am unable to offer guidance on this topic."); chatHistory.pop(); renderChatHistory(); setProState('prompt'); }
        }
        function renderChatHistory() {
            const container = document.getElementById('chatHistory');
            container.innerHTML = chatHistory.map((turn, index) => {
                const isUser = turn.role === 'user';
                const avatar = isUser ? `<div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center font-bold text-white">You</div>` : `<div class="w-10 h-10 rounded-full bg-yellow-600 flex items-center justify-center text-2xl">üïäÔ∏è</div>`;
                const contentBg = isUser ? 'bg-blue-100' : 'bg-white';
                const content = turn.parts[0].text.replace(/\n/g, '<br>');
                const audioBtn = !isUser ? `<div class="mt-3"><button id="audioBtn_${index}" onclick="playAudio(this, ${index})" class="text-sm font-semibold text-yellow-700 hover:text-yellow-800 flex items-center gap-1">‚ñ∂ Listen to Guidance</button></div>` : '';
                return `<div class="flex items-start gap-4 ${isUser ? 'justify-end' : ''}">${!isUser ? avatar : ''}<div class="${contentBg} p-4 rounded-xl max-w-xl shadow-md border border-slate-100"><div class="response-text">${content}</div>${audioBtn}</div>${isUser ? avatar : ''}</div>`;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }
        function base64ToArrayBuffer(b){const c=window.atob(b),d=c.length,e=new Uint8Array(d);for(let a=0;a<d;a++)e[a]=c.charCodeAt(a);return e.buffer}function pcmToWav(e,f){const g=new ArrayBuffer(44),a=new DataView(g);function h(a,b,c){for(let d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}return h(a,0,"RIFF"),a.setUint32(4,36+2*e.length,!0),h(a,8,"WAVE"),h(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,f,!0),a.setUint32(28,2*f,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),h(a,36,"data"),a.setUint32(40,2*e.length,!0),b=new Int16Array(44+2*e.length),b.set(new Int16Array(g),0),b.set(e,22),new Blob([b],{type:"audio/wav"})}
        async function playAudio(button, index) {
            button.innerHTML = '...'; button.disabled = true;
            const textToPlay = chatHistory[index].parts[0].text;
            const payload = {contents: [{ parts: [{ text: `Read in a calm, clear, and reverent voice: ${textToPlay}` }] }], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Iapetus" } } } }, model: "gemini-2.5-flash-preview-tts"};
            const result = await callGeminiAPI('gemini-2.5-flash-preview-tts', payload);
            if (result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data) {
                const data = result.candidates[0].content.parts[0].inlineData, sampleRate = parseInt(data.mimeType.match(/rate=(\d+)/)[1], 10);
                const pcm16 = new Int16Array(base64ToArrayBuffer(data.data)), wavBlob = pcmToWav(pcm16, sampleRate);
                const audio = new Audio(URL.createObjectURL(wavBlob));
                audio.play(); button.innerHTML = '‚ùö‚ùö Playing...'; audio.onended = () => { button.innerHTML = '‚ñ∂ Listen to Guidance'; };
            } else { showToast("Could not generate audio."); button.innerHTML = '‚ñ∂ Listen to Guidance'; }
            button.disabled = false;
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            isPro = localStorage.getItem('goodwordPro') === 'true';
            showPage('home');
            loadProfile(); loadBlogPosts(); loadMessageBoard();
        });
    </script>
</body>
</html>
